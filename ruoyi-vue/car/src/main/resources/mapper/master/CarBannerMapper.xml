<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.car.mapper.master.CarBannerMapper">
    
    <resultMap type="com.ruoyi.car.domain.CarBannerEntity" id="CarBannerResult">
        <id     property="id"           column="id"           />
        <result property="imageUrl"      column="imageUrl"    />
        <result property="linkUrl"       column="linkUrl"     />
        <result property="isLink"        column="isLink"      />
        <result property="showOrder"     column="showOrder"   />
        <result property="delFlag"       column="delFlag"     />
        <result property="createTime"    column="createTime"  />
        <result property="bannerType"    column="bannerType"  />
    </resultMap>
    
    <sql id="selectCarBannerVo">
        select id, imageUrl, linkUrl, isLink, showOrder, delFlag, createTime, bannerType 
        from car_banner
    </sql>
    
    <select id="selectAllOrderByShowOrder" resultType="com.ruoyi.car.domain.CarBannerEntity">
        select id, imageUrl, linkUrl, isLink, COALESCE(showOrder, 0) as showOrder, delFlag, createTime, bannerType 
        from car_banner
        where (delFlag = 0 or delFlag is null)
        <if test="bannerType != null">
            and bannerType = #{bannerType}
        </if>
        order by COALESCE(showOrder, 0) asc, createTime desc
    </select>
    
    <update id="batchUpdateShowOrder" parameterType="java.util.List">
        update car_banner 
        set showOrder = 
        case id 
        <foreach collection="banners" item="banner">
            when #{banner.id} then #{banner.showOrder}
        </foreach>
        end
        where id in
        <foreach collection="banners" item="banner" open="(" separator="," close=")">
            #{banner.id}
        </foreach>
    </update>
    
    <select id="selectMaxShowOrder" resultType="java.lang.Integer">
        select COALESCE(MAX(showOrder), 0) from car_banner where delFlag = 0 or delFlag is null
    </select>
    
</mapper> 