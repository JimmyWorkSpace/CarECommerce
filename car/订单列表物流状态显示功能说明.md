# 订单列表物流状态显示功能说明

## 功能概述

为订单列表页面添加了物流状态显示功能，仅对已支付的订单（orderStatus = 2）显示物流状态信息。

## 实现内容

### 1. 前端模板修改

**文件：** `src/main/resources/templates/my-order/index.ftl`

**修改内容：**
- 在订单信息区域添加了物流状态显示行
- 仅对已支付订单（orderStatus === 2）显示物流状态
- 添加了物流状态图标（卡车图标）

### 2. JavaScript逻辑

**新增方法：**

#### `getLogisticsStatusText(order)`
- 根据订单的物流状态码（logicStatusCode）显示对应的中文状态
- 如果没有状态码但有物流消息（logicMsg），显示物流消息内容
- 如果都没有，显示"物流信息待更新"

**状态码映射：**
- 300: 訂單建立
- 301: 待收件
- 302: 已收件
- 303: 配送中
- 304: 已取件
- 305: 已送達
- 306: 退貨中
- 307: 已退貨
- 308: 配送異常
- 309: 已取消

#### `getLogisticsStatusClass(order)`
- 根据物流状态返回对应的CSS样式类
- 为不同状态提供不同的颜色和样式

### 3. CSS样式

**文件：** `src/main/resources/static/css/my-pages.css`

**新增样式类：**
- `.logistics-status`: 基础物流状态样式
- `.logistics-created`: 订单建立（蓝色）
- `.logistics-pending`: 待收件（黄色）
- `.logistics-received`: 已收件（蓝色）
- `.logistics-shipping`: 配送中（青色）
- `.logistics-picked`: 已取件（绿色）
- `.logistics-delivered`: 已送达（绿色，加粗）
- `.logistics-returning`: 退货中（红色）
- `.logistics-returned`: 已退货（红色）
- `.logistics-error`: 配送异常（红色，加粗）
- `.logistics-cancelled`: 已取消（红色）
- `.logistics-unknown`: 未知状态（灰色）
- `.logistics-message`: 物流消息（黄色，斜体）
- `.logistics-default`: 默认状态（浅灰色）

## 显示逻辑

1. **有物流状态码（logicStatusCode）**：
   - 根据状态码显示对应的中文状态
   - 应用对应的颜色样式

2. **无状态码但有物流消息（logicMsg）**：
   - 直接显示物流消息内容
   - 应用消息样式（黄色背景，斜体）

3. **无物流信息**：
   - 显示"物流信息待更新"
   - 应用默认样式（浅灰色）

## 测试数据

提供了测试SQL脚本 `test_logistics_status_display.sql`，包含：
- 有状态码的订单
- 只有消息的订单
- 已送达状态
- 配送异常状态
- 无物流信息的订单

## 使用说明

1. 确保订单实体包含以下字段：
   - `logicStatusCode`: 物流状态码
   - `logicMsg`: 物流消息
   - `logicMsgJson`: 物流完整信息

2. 在订单列表页面，已支付的订单会自动显示物流状态

3. 物流状态会根据实际数据动态更新

## 兼容性

- 与现有的订单状态显示功能完全兼容
- 不影响未支付订单的显示
- 支持响应式设计，在移动端也能正常显示

## 错误修复

### FreeMarker模板错误修复

**问题：** 在访问 `order.logicStatusCode` 时出现FreeMarker模板错误

**解决方案：**
1. 在JavaScript中添加了安全的属性访问检查
2. 使用try-catch包装方法，防止运行时错误
3. 对null、undefined和空字符串进行了完整的检查
4. 添加了错误日志记录，便于调试

**修复内容：**
- `getLogisticsStatusText(order)` 方法：添加了安全的属性访问和错误处理
- `getLogisticsStatusClass(order)` 方法：添加了相同的安全检查和错误处理
- 确保在属性为null或undefined时不会导致页面崩溃

**测试覆盖：**
- null值情况
- undefined值情况  
- 空字符串情况
- 正常值情况
- 异常情况（通过try-catch处理）
