# 物流查询功能完善说明

## 概述
根据绿界科技官方文档 [物流查询API](https://developers.ecpay.com.tw/?p=7418)，完善了物流查询结果的字段映射和订单详情页的显示功能。

## 主要改进

### 1. LogisticsQueryResultDto 字段完善

#### 新增/完善的字段注释：
- **ActualWeight**: 实际重量，当物流子类型为POST(中华邮政)才会回传
- **AllPayLogisticsID**: 绿界科技的物流交易编号
- **BookingNote**: 托运单号，物流类型为HOME才会回传
- **CollectionAllocateAmount**: 物流代收款项拨款金额
- **CollectionAllocateDate**: 物流代收款项拨款日期
- **CVSPaymentNo**: 寄货编号，物流类型为CVS才会回传
- **CVSValidationNo**: 验证码，(C2C) 7-ELEVEN才会回传
- **GoodsAmount**: 商品金额，商品遗失赔偿依据
- **HandlingCharge**: 物流费用
- **LogisticsStatus**: 物流状态，参考物流状态代码一览表
- **LogisticsType**: 会员选择的物流方式，参考物流方式一览表
- **ShipmentNo**: 配送编号，物流类型为CVS才会回传
- **TradeDate**: 订单成立时间，格式为：yyyy/MM/dd HH:mm:ss

### 2. 订单详情页物流信息块增强

#### 新增显示字段：
1. **寄货编号** (CVSPaymentNo) - 超商C2C配送编号
2. **验证码** (CVSValidationNo) - 7-ELEVEN交货便验证码
3. **寄件人手机** (SenderCellPhone) - 寄件人手机号码
4. **运费扣款日期** (ShipChargeDate) - 物流运费扣款日期
5. **实际重量** (ActualWeight) - 实际测量重量（中华邮政）

#### 新增代收信息区块：
- **代收金额** (CollectionAmount)
- **代收手续费** (CollectionChargeFee)
- **拨款金额** (CollectionAllocateAmount)
- **拨款日期** (CollectionAllocateDate)

### 3. 物流类型映射完善

根据官方文档，完善了物流类型的映射：

```javascript
const typeMap = {
    // 宅配类型
    'HOME_TCAT': '宅配-黑貓宅急便',
    'HOME_ECAN': '宅配-宅配通',
    'HOME_FAMI': '宅配-全家宅配通',
    'HOME_POST': '宅配-中華郵政',
    // 超商类型
    'CVS_FAMI': '超商-全家',
    'CVS_OK': '超商-OK超商',
    'CVS_HILIFE': '超商-萊爾富',
    'CVS_IBON': '超商-7-11',
    'CVS_UNIMART': '超商-統一超商',
    // 其他类型
    'HOME': '宅配',
    'CVS': '超商'
};
```

### 4. 物流状态映射

根据官方文档的物流状态代码一览表：

```javascript
const statusMap = {
    '300': '訂單建立',
    '301': '待收件',
    '302': '已收件',
    '303': '配送中',
    '304': '已取件',
    '305': '已送達',
    '306': '退貨中',
    '307': '已退貨',
    '308': '配送異常',
    '309': '已取消'
};
```

### 5. 界面优化

#### 智能显示逻辑：
- 根据物流类型显示相应字段（宅配显示托运单号，超商显示寄货编号）
- 7-ELEVEN C2C 显示验证码组合
- 代收信息仅在代收金额不为0时显示
- 实际重量仅在中华邮政物流时显示

#### 视觉优化：
- 使用不同颜色标识重要信息
- 寄货编号和验证码使用醒目的颜色
- 代收金额使用绿色突出显示
- 添加相应的图标增强可读性

## 技术实现

### API 接口
- **接口路径**: `GET /api/logistics/query?orderNo=xxx`
- **返回格式**: `R<LogisticsQueryResultDto>`
- **数据来源**: 绿界科技物流查询API

### 前端实现
- 使用 Vue.js 响应式数据绑定
- 条件渲染显示相关字段
- 实时刷新物流信息
- 错误处理和加载状态

## 注意事项

1. **字段映射**: 前端使用大写开头的字段名与后端DTO保持一致
2. **条件显示**: 某些字段仅在特定物流类型下显示
3. **数据验证**: 对空值和特殊情况进行处理
4. **用户体验**: 提供加载状态和错误提示

## 相关文档

- [绿界科技物流查询API文档](https://developers.ecpay.com.tw/?p=7418)
- [物流状态代码一览表](https://developers.ecpay.com.tw/?p=7418#物流状态代码一览表)
- [物流方式一览表](https://developers.ecpay.com.tw/?p=7418#物流方式一览表)

## 测试建议

1. 测试不同物流类型的订单显示
2. 验证7-ELEVEN C2C的验证码组合显示
3. 测试代收信息的条件显示
4. 验证实际重量字段的显示条件
5. 测试物流信息的实时刷新功能
