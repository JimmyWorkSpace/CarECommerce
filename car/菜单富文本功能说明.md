# 菜单富文本功能说明

## 功能概述

为CarMenuEntity新增了两个字段`linkType`和`content`，实现了菜单的两种显示方式：

- **linkType = 0**：普通链接类型，点击菜单跳转到指定的`linkUrl`
- **linkType = 1**：富文本类型，点击菜单显示`content`中的富文本内容

## 实现细节

### 1. 数据库字段

在`car_menu`表中新增了两个字段：
- `linkType`：链接类型（0=普通链接，1=富文本）
- `content`：富文本内容（HTML格式）

### 2. 后端实现

#### CarMenuEntity
- 新增了`linkType`和`content`字段的getter/setter方法

#### CarMenuService
- 新增了`getMenuById(Long id)`方法，用于根据ID获取菜单信息

#### CarViewController
- 新增了`/menu-content/{id}`接口：显示菜单富文本内容的主页面
- 新增了`/menu-content/{id}/content`接口：用于iframe显示富文本内容

### 3. 前端实现

#### 模板文件
- `src/main/resources/templates/menu/index.ftl`：菜单富文本内容主页面
- `src/main/resources/templates/menu/content-iframe.ftl`：富文本内容iframe页面

#### 菜单链接逻辑
修改了`src/main/resources/templates/layout/main.ftl`中的菜单显示逻辑：
```freemarker
<#if menu.linkType?? && menu.linkType == 1>
    <!-- 富文本类型菜单，跳转到富文本显示页面 -->
    <a class="nav-link" href="/menu-content/${menu.id}">${menu.title!''}</a>
<#else>
    <!-- 普通链接类型菜单，跳转到指定URL -->
    <a class="nav-link" href="${menu.linkUrl!''}">${menu.title!''}</a>
</#if>
```

### 4. 样式设计

富文本内容页面采用了与现有`rich-content`页面相同的样式设计：
- 响应式布局
- 美观的排版样式
- iframe高度自适应
- 支持各种HTML元素（标题、段落、列表、表格、图片等）

## 使用方法

### 1. 创建富文本菜单

在数据库中插入菜单数据：
```sql
INSERT INTO car_menu (title, showOrder, delFlag, createTime, isShow, canDel, linkUrl, linkType, content) VALUES
('服務條款', 6, 0, NOW(), 1, 1, '', 1, '<h1>服務條款</h1><p>內容...</p>');
```

### 2. 访问富文本菜单

用户点击菜单时：
- 如果`linkType = 0`，跳转到`linkUrl`指定的页面
- 如果`linkType = 1`，跳转到`/menu-content/{id}`显示富文本内容

### 3. 富文本内容格式

`content`字段支持完整的HTML格式，包括：
- 标题（h1-h6）
- 段落（p）
- 列表（ul, ol, li）
- 表格（table, tr, td, th）
- 图片（img）
- 链接（a）
- 强调文本（strong, em）
- 代码（code, pre）

## 测试数据

提供了`test_menu_rich_content_data.sql`文件，包含：
- 服務條款菜单（富文本类型）
- 隱私政策菜单（富文本类型）

## 技术特点

1. **复用现有架构**：复用了`rich-content`的iframe显示方式
2. **响应式设计**：支持各种设备屏幕尺寸
3. **高度自适应**：iframe高度根据内容自动调整
4. **安全性**：对菜单访问权限进行了验证
5. **错误处理**：完善的异常处理和错误提示

## 注意事项

1. 富文本内容应该使用安全的HTML标签，避免XSS攻击
2. 建议对富文本内容进行适当的长度限制
3. 定期备份菜单数据
4. 在生产环境中建议对富文本内容进行HTML过滤和验证
